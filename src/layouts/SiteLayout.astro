---
// Importation des composants et des styles
import IosPointer from "@/components/IosPointer.jsx";
const {
  title = "Stéphanie Quibel — Développeuse WordPress",
  description = "",
} = Astro.props;
import "@/styles/base.css";
import "@/styles/layout.css";
import "@/styles/components/header.css";
import "@/styles/components/buttons.css";
import "@/styles/components/pointer.css";
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    {description && <meta name="description" content={description} />}

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@600;700&family=Lato:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="/favicon.png" type="image/png" />
    <meta name="theme-color" content="#23212E" />

    <!-- Initialisation du thème clair/sombre (par défaut : clair) -->
    <script is:inline>
      (() => {
        try {
          const pref = localStorage.getItem("theme-pref") || "light";
          document.documentElement.dataset.theme = pref;
        } catch {
          document.documentElement.dataset.theme = "light";
        }
      })();
    </script>
  </head>

  <body>
    <!-- Pointer performant, uniquement sur desktop avec support de l'hover -->
    <IosPointer
      client:media="(hover: hover) and (pointer: fine)"
      color="var(--green)"
      radius={2}
      pad={8}
      magnetRadius={56}
      targets='[data-pointer], .nav a, a[href], button, [role="button"]'
    />

    <header class="site-header">
      <div class="container nav">
        <a class="brand" href="/">
          <img
            class="brand-logo"
            src="/logo.svg"
            alt="Stéphanie Quibel"
            width="80"
            height="80"
          />
        </a>

        <nav aria-label="Navigation principale">
          <ul>
            <li>
              <a
                href="/"
                aria-current={Astro.url.pathname === "/" ? "page" : undefined}
                >Accueil</a
              >
            </li>
            <li>
              <a
                href="/services"
                aria-current={Astro.url.pathname.startsWith("/services")
                  ? "page"
                  : undefined}>Services</a
              >
            </li>
            <li>
              <a
                href="/realisations"
                aria-current={Astro.url.pathname.startsWith("/realisations")
                  ? "page"
                  : undefined}>Réalisations</a
              >
            </li>
            <li>
              <a
                href="/blog"
                aria-current={Astro.url.pathname.startsWith("/blog")
                  ? "page"
                  : undefined}>Parlons web</a
              >
            </li>
            <li><a href="/#a-propos">À propos</a></li>
            <li>
              <a
                href="/contact"
                class="btn btn--ghost"
                aria-current={Astro.url.pathname.startsWith("/contact")
                  ? "page"
                  : undefined}>Contact</a
              >
            </li>
          </ul>
        </nav>

        <!-- Bouton pour basculer entre le mode clair et sombre -->
        <button
          id="theme-toggle"
          class="btn btn--ghost"
          type="button"
          aria-label="Basculer le thème"
          title="Basculer le thème"
        >
          <!-- Icône soleil -->
          <svg
            class="theme-icon theme-icon--sun"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              d="M12 4V2M12 22v-2M4.93 4.93 3.51 3.51M20.49 20.49l-1.42-1.42M4 12H2m20 0h-2M4.93 19.07l-1.42 1.42M20.49 3.51l-1.42 1.42"
              stroke="currentColor"
              stroke-width="1.5"
              fill="none"
              stroke-linecap="round"></path>
            <circle
              cx="12"
              cy="12"
              r="4"
              stroke="currentColor"
              stroke-width="1.5"
              fill="none"></circle>
          </svg>
          <!-- Icône lune -->
          <svg
            class="theme-icon theme-icon--moon"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"
              stroke="currentColor"
              stroke-width="1.5"
              fill="none"
              stroke-linejoin="round"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- Zone principale : Hero et contenu -->
    <slot name="hero" />
    <main class="container"><slot /></main>

    <footer>
      <div class="container foot">
        <span>© {new Date().getFullYear()} Stéphanie Quibel</span>
        <span><a href="/mentions-legales">Mentions légales</a></span>
      </div>
    </footer>

    <!-- Scripts pour améliorer la performance et l'accessibilité -->
    <script is:inline>
      (function () {
        // 1) Effet sur le scroll : supprimer l'effet de flou dans l'entête pendant le scroll
        let t;
        const header = document.querySelector("header.site-header");
        const onScroll = () => {
          if (!header) return;
          clearTimeout(t);
          header.classList.add("scrolling");
          t = setTimeout(() => header.classList.remove("scrolling"), 140);
        };
        addEventListener("scroll", onScroll, { passive: true });

        // 2) Variable CSS pour la hauteur réelle de l'entête (utile pour les ancrages)
        const setHeaderH = () => {
          if (!header) return;
          document.documentElement.style.setProperty(
            "--header-h",
            header.offsetHeight + "px"
          );
        };
        setHeaderH();
        addEventListener("resize", setHeaderH);

        // 3) Mode éco automatique : désactive certaines animations si l'utilisateur a activé l'option "réduire les mouvements"
        if (matchMedia("(prefers-reduced-motion: reduce)").matches) {
          document.documentElement.classList.add("reduce-motion");
        } else {
          document.documentElement.classList.remove("reduce-motion");
        }
      })();
    </script>

    <!-- Logiciel pour basculer entre le mode clair et sombre -->
    <script is:inline>
      (function () {
        const KEY = "theme-pref";
        const btn = document.getElementById("theme-toggle");
        function apply(pref) {
          document.documentElement.dataset.theme = pref;
          try {
            localStorage.setItem(KEY, pref);
          } catch {}
        }
        function next(pref) {
          return pref === "light" ? "dark" : "light";
        }
        const saved =
          localStorage.getItem(KEY) ||
          document.documentElement.dataset.theme ||
          "light";
        apply(saved);
        btn?.addEventListener("click", () =>
          apply(next(localStorage.getItem(KEY) || "light"))
        );
      })();
    </script>
  </body>
</html>
