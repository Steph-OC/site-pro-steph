---
import IosPointer from "@/components/IosPointer.jsx";
const {
  title = "Stéphanie Quibel — Développeuse WordPress",
  description = "",
} = Astro.props;
import "../styles/theme.css"; // <-- nouveau
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    {description && <meta name="description" content={description} />}

    <!-- Fonts (si tu préfères garder ici plutôt que via @import) -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@600;700&family=Lato:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="/favicon.png" type="image/png" />
    <meta name="theme-color" content="#23212E" />

    <!-- Init thème: lit la préférence et n’impose rien si “system” -->
    <script is:inline>
      (() => {
        try {
          const pref = localStorage.getItem("theme-pref") || "system";
          if (pref === "light" || pref === "dark") {
            document.documentElement.dataset.theme = pref;
          } else {
            document.documentElement.removeAttribute("data-theme");
          }
        } catch {}
      })();
    </script>
  </head>

  <IosPointer
    client:idle
    color="var(--green)"
    radius={12}
    pad={6}
    magnetRadius={90}
    targets='[data-pointer], .nav a, a[href], button, [role="button"]'
  />

  <body>
    <header>
      <div class="container nav">
        <a class="brand" href="/"
          ><img
            class="brand-logo"
            src="/logo.svg"
            alt="Stéphanie Quibel"
            width="80"
            height="80"
          />
        </a>
        <nav aria-label="Navigation principale">
          <ul>
            <li>
              <a
                href="/"
                aria-current={Astro.url.pathname === "/" ? "page" : undefined}
                >Accueil</a
              >
            </li>
            <li>
              <a
                href="/services"
                aria-current={Astro.url.pathname.startsWith("/services")
                  ? "page"
                  : undefined}>Services</a
              >
            </li>
            <li>
              <a
                href="/realisations"
                aria-current={Astro.url.pathname.startsWith("/realisations")
                  ? "page"
                  : undefined}>Réalisations</a
              >
            </li>
            <li>
              <a
                href="/blog"
                aria-current={Astro.url.pathname.startsWith("/blog")
                  ? "page"
                  : undefined}>Parlons web</a
              >
            </li>
            <li><a href="/#a-propos">À propos</a></li>
            <li>
              <a
                href="/contact"
                class="btn btn--ghost"
                aria-current={Astro.url.pathname.startsWith("/contact")
                  ? "page"
                  : undefined}>Contact</a
              >
            </li>
          </ul>
        </nav>

        <!-- Toggle 3 états System → Light → Dark -->
        <button
          id="theme-toggle"
          class="btn btn--ghost"
          type="button"
          aria-label="Thème : auto"
          title="Changer le thème">🌓</button
        >
      </div>
    </header>

    <slot name="hero" />

    <main class="container">
      <slot />
    </main>

    <footer>
      <div class="container foot">
        <span>© {new Date().getFullYear()} Stéphanie Quibel</span>
        <span><a href="/mentions-legales">Mentions légales</a></span>
      </div>
    </footer>

    <!-- Toggle logic (3 états + persistance + respect système) -->
    <script is:inline>
      (function () {
        const KEY = "theme-pref"; // "system" | "light" | "dark"
        const order = ["system", "light", "dark"];
        const btn = document.getElementById("theme-toggle");

        function apply(pref) {
          if (pref === "light" || pref === "dark") {
            document.documentElement.dataset.theme = pref;
          } else {
            document.documentElement.removeAttribute("data-theme");
          }
          try {
            localStorage.setItem(KEY, pref);
          } catch {}
          if (btn)
            btn.setAttribute(
              "aria-label",
              "Thème : " + (pref === "system" ? "auto" : pref)
            );
        }

        function next(pref) {
          return order[(order.indexOf(pref) + 1) % order.length];
        }

        const saved = localStorage.getItem(KEY) || "system";
        apply(saved);

        btn?.addEventListener("click", () => {
          const current = localStorage.getItem(KEY) || "system";
          apply(next(current));
        });

        // Si l’utilisateur change la préférence système en live et qu’on est sur “system”
        const mq = window.matchMedia("(prefers-color-scheme: dark)");
        mq.addEventListener?.("change", () => {
          const pref = localStorage.getItem(KEY) || "system";
          if (pref === "system") apply("system");
        });
      })();
    </script>
  </body>
</html>
