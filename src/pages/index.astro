---
import SiteLayout from "@/layouts/SiteLayout.astro";
import Hero from "@/components/Hero.astro";
import Services from "@/components/Services";
import BadgesMotion from "@/components/BadgesMotion";
import ProjectSlider from "@/components/ProjectSlider";
import { Reveal, RevealGroup } from "@/components/Scroll";

// WP helpers (slides + card_title/intro + siteUrl)
import { getDerniersProjetsAvecSlides } from "@/lib/wp";

const title = "Développeuse WordPress freelance — Stéphanie Quibel";
const description =
  "Sites WordPress rapides, accessibles et bien référencés. Refonte, création, maintenance. Réponse sous 24h.";

// Charge 2 projets depuis WP (ACF Free, champs fixes)
const data = await getDerniersProjetsAvecSlides(2);
const p1 = data?.[0];
const p2 = data?.[1];
---

<SiteLayout {title} {description}>
  <Fragment slot="hero">
    <Hero
      variant="home"
      bg="glass"
      bleed
      visual="codeReveal"
      kicker="WordPress sur mesure"
      title="Développeuse WordPress — sites rapides & accessibles"
      lead="Je conçois et optimise des sites vitrine & blog qui chargent vite, sont confortables à lire et visibles localement. Réponse sous 24h."
      actions={[
        {
          href: "/realisations/",
          label: "Voir mes réalisations",
          kind: "accent",
        },
        { href: "/contact", label: "Parler de votre projet", kind: "ghost" },
      ]}
    />
  </Fragment>

  <main id="home" class="halo-desync">
    <!-- Principes -->
    <section
      class="section--halo halo-pulse-gentle"
      aria-labelledby="principes"
    >
      <div class="container container--xl">
        <header class="section-head">
          <h2 id="principes">Principes clés</h2>
          <p class="section-sub">Ce qui guide chaque projet.</p>
        </header>
        <BadgesMotion client:visible />
      </div>
    </section>

    <!-- Services (animés via RevealGroup) -->
    <section
      class="section--halo halo-pulse-gentle"
      aria-labelledby="services-title"
    >
      <div class="container container--xl">
        <header class="section-head">
          <h2 id="services-title">Mes services</h2>
          <p class="section-sub">Création, refonte, accompagnement.</p>
        </header>

        <RevealGroup
          client:visible
          as="div"
          cascade
          dir="up"
          amount={0.2}
          rootMargin="0px 0px -25% 0px"
        >
          <Services />
        </RevealGroup>
      </div>
    </section>

    <!-- Derniers projets -->
    <section
      class="container section--halo halo-pulse-gentle"
      aria-labelledby="dern-projets"
    >
      <header class="section-head">
        <h2 id="dern-projets">Derniers projets</h2>
        <p class="section-sub">
          Deux sites récents, avec leurs fonctionnalités clés.
        </p>
      </header>

      <div class="projects-grid">
        {
          p1 && (
            <Reveal client:visible direction="left">
              <article class="card project-card">
                <div class="card__body">
                  <h3 class="h3">{p1.cardTitle ?? "Projet récent #1"}</h3>
                  <p class="muted">
                    {p1.cardIntro ??
                      p1.subtitle ??
                      "Focus sur les fonctionnalités marquantes."}
                  </p>

                  <ProjectSlider
                    client:visible
                    slides={p1.slides}
                    accent="#fd7e14"
                    siteUrl={p1.projet.siteUrl || "#"}
                    detailsUrl="/realisations/studio-sonore"
                  />
                </div>
              </article>
            </Reveal>
          )
        }

        {
          p2 && (
            <Reveal client:visible direction="right" delay={0.08}>
              <article class="card project-card">
                <div class="card__body">
                  <h3 class="h3">{p2.cardTitle ?? "Projet récent #2"}</h3>
                  <p class="muted">
                    {p2.cardIntro ??
                      p2.subtitle ??
                      "Navigation fluide, mode sombre et galerie optimisée."}
                  </p>

                  <ProjectSlider
                    client:visible
                    slides={p2.slides}
                    accent="#22b8cf"
                    siteUrl={p2.projet.siteUrl || "#"}
                    detailsUrl="/realisations/studio-sonore"
                  />
                </div>
              </article>
            </Reveal>
          )
        }
      </div>
    </section>

    <!-- Témoignage / Zones -->
    <section class="container section--halo halo-pulse-gentle">
      <div class="grid">
        <article class="card">
          <div class="card__body">
            <h2>Témoignage</h2>
            <p>
              “Clair, rapide, efficace. On a gagné en visibilité et en
              contacts.”
            </p>
            <p class="muted">— Client satisfait</p>
          </div>
        </article>

        <article class="card">
          <div class="card__body local">
            <h2>Zones desservies</h2>
            <p class="muted">
              Béziers, Agde, Pézenas… et à distance partout en France.
            </p>
            <iframe
              title="Plan Béziers"
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              src="https://maps.google.com/maps?q=B%C3%A9ziers&t=&z=12&ie=UTF8&iwloc=&output=embed"
            ></iframe>
          </div>
        </article>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="section--alt section--halo halo-pulse-gentle">
      <div class="container container--narrow">
        <h2>FAQ</h2>
        <details class="faq">
          <summary>Combien coûte un site vitrine WordPress ?</summary>
          <p>
            Selon le périmètre, entre 1 500€ et 4 000€ en moyenne. Je fournis un
            devis détaillé.
          </p>
        </details>
        <details class="faq">
          <summary>Quels délais pour la livraison ?</summary>
          <p>De 2 à 6 semaines selon le contenu et les fonctionnalités.</p>
        </details>
      </div>
    </section>

    <!-- CTA -->
    <section class="container section--halo halo-pulse-gentle">
      <article class="card">
        <div class="card__body">
          <h2>Parlons de votre projet</h2>
          <p class="muted">
            Réponse sous 24 h. Vos données ne sont jamais revendues.
          </p>
          <div class="actions" style="display:flex;gap:.6rem;flex-wrap:wrap;">
            <a
              class="btn btn--accent btn--lg cursor-hover-item"
              href="/contact"
              data-cursor-text="CONTACT"
              data-cursor-text-repeat="6">Ouvrir la page Contact</a
            >
            <a
              class="btn btn--ghost cursor-hover-item"
              href="mailto:contact@stephaniequibel.fr"
              data-cursor-text="ÉCRIRE UN E-MAIL"
              data-cursor-text-repeat="5">Écrire un e-mail</a
            >
          </div>
        </div>
      </article>
    </section>
  </main>
</SiteLayout>

<!-- JSON-LD inchangé -->
<script
  type="application/ld+json"
  set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Organization",
    name: "Stéphanie Quibel",
    url: "https://stephaniequibel.fr/",
    sameAs: ["https://www.linkedin.com"],
    logo: "https://stephaniequibel.fr/logo.png",
  })}
/>
<script
  type="application/ld+json"
  set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "ProfessionalService",
    name: "Stéphanie Quibel — Développeuse WordPress",
    url: "https://stephaniequibel.fr/",
    areaServed: { "@type": "AdministrativeArea", name: "Hérault" },
    serviceArea: [
      { "@type": "City", name: "Béziers" },
      { "@type": "City", name: "Agde" },
    ],
    email: "mailto:contact@stephaniequibel.fr",
    telephone: "+33-6-00-00-00-00",
  })}
/>
<script
  type="application/ld+json"
  set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "FAQPage",
    mainEntity: [
      {
        "@type": "Question",
        name: "Combien coûte un site vitrine WordPress ?",
        acceptedAnswer: {
          "@type": "Answer",
          text: "Selon le périmètre, entre 1 500€ et 4 000€ en moyenne, incluant design, intégration et optimisation.",
        },
      },
      {
        "@type": "Question",
        name: "Quels délais de livraison ?",
        acceptedAnswer: {
          "@type": "Answer",
          text: "Entre 2 et 6 semaines selon le contenu et les fonctionnalités.",
        },
      },
    ],
  })}
/>
