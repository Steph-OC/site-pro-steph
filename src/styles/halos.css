/* ============================================
   HALOS — source de vérité unique
   ============================================ */

/* --- Base section halo --- */
.section--halo {
  position: relative; /* ancre le ::before */
  isolation: isolate; /* nouveau contexte de pile */
  overflow: visible; /* le halo peut déborder */
  background: transparent !important;
  z-index: 0; /* cette section ne survole personne */

  /* Couleurs par défaut (clair) */
  --halo-a: color-mix(in srgb, var(--green) 20%, transparent);
  --halo-b: color-mix(in srgb, var(--orange) 18%, transparent);

  /* Gabarit & placement par défaut */
  --halo-w: min(1100px, 92vw);
  --halo-h: 420px;
  --halo-x: 0px;
  --halo-y: 0px;
  --halo-overlap: 140px; /* remontée au-dessus de la section */
}

/* Halo (derrière le contenu, mais visible) */
.section--halo::before {
  content: "";
  position: absolute;
  left: 50%;
  bottom: calc(100% - var(--halo-overlap));
  width: var(--halo-w);
  height: var(--halo-h);
  transform-origin: 50% 100%;
  transform: translate(calc(-50% + var(--halo-x)), var(--halo-y));
  pointer-events: none;
  z-index: 0; /* IMPORTANT : pas de négatif */

  background:
    radial-gradient(60% 55% at 30% 40%, var(--halo-a), transparent 65%),
    radial-gradient(60% 55% at 70% 60%, var(--halo-b), transparent 70%);
  filter: blur(38px) saturate(120%);
  opacity: 0.9;

  /* adoucit les bords (évite une “bande” rectangulaire) */
  -webkit-mask-image: radial-gradient(
    120% 110% at 50% 55%,
    #000 60%,
    transparent 100%
  );
  mask-image: radial-gradient(120% 110% at 50% 55%, #000 60%, transparent 100%);

  /* animation douce */
  animation:
    haloBreath 6.5s ease-in-out infinite,
    haloDrift 18s ease-in-out 0.3s infinite alternate;
}

/* Contenu au-dessus du halo */
.section--halo > * {
  position: relative;
  z-index: 1;
}

/* Animations communes */
@keyframes haloBreath {
  0%,
  100% {
    opacity: 0.78;
    transform: translate(calc(-50% + var(--halo-x)), var(--halo-y));
  }
  50% {
    opacity: 1;
    transform: translate(calc(-50% + var(--halo-x)), var(--halo-y)) scale(1.06);
  }
}
@keyframes haloDrift {
  0% {
    filter: blur(36px) saturate(118%);
  }
  50% {
    filter: blur(44px) saturate(124%);
  }
  100% {
    filter: blur(38px) saturate(120%);
  }
}

/* Thème sombre : teintes plus froides, un peu moins lumineuses */
:root[data-theme="dark"] .section--halo::before {
  --halo-a: color-mix(in srgb, #60a5fa 22%, transparent);
  --halo-b: color-mix(in srgb, #8b5cf6 20%, transparent);
  filter: blur(44px) saturate(118%) brightness(0.96);
  opacity: 0.88;
}

/* Mobile : halos plus compacts */
@media (max-width: 720px) {
  .section--halo {
    --halo-w: min(900px, 96vw);
    --halo-h: 360px;
    --halo-overlap: 120px;
  }
}

/* --- Variantes par position (home) — optionnelles --- */
#home > section.section--halo:nth-of-type(1)::before {
  --halo-h: 360px;
  --halo-overlap: 120px;
  --halo-x: -40px;
}
#home > section.section--halo:nth-of-type(2)::before {
  --halo-w: min(1250px, 95vw);
  --halo-h: 440px;
  --halo-overlap: 160px;
}
#home > section.section--halo:nth-of-type(3)::before {
  --halo-h: 420px;
  --halo-overlap: 110px;
  --halo-x: 60px;
  --halo-y: 6px;
}

/* Helpers d’offset simple */
.section--halo.halo-left::before {
  --halo-x: -60px;
}
.section--halo.halo-right::before {
  --halo-x: 60px;
}
.section--halo.halo-tall::before {
  --halo-h: 500px;
  --halo-overlap: 180px;
}

/* --- Désynchro douce entre sections (option) --- */
.halo-desync .section--halo:nth-of-type(1n)::before {
  animation-duration: 16s, 18s;
  animation-delay: 0.2s, 0.2s;
}
.halo-desync .section--halo:nth-of-type(2n)::before {
  animation-duration: 17s, 19.8s;
  animation-delay: 0.8s, 0.4s;
}
.halo-desync .section--halo:nth-of-type(3n)::before {
  animation-duration: 15s, 16.5s;
  animation-delay: 0s, 0.1s;
}
.halo-desync .section--halo:nth-of-type(4n)::before {
  animation-duration: 18s, 21.6s;
  animation-delay: 1.2s, 0.6s;
}
.halo-desync .section--halo:nth-of-type(5n)::before {
  animation-duration: 16s, 17.6s;
  animation-delay: 0.4s, 0.3s;
}

/* --- Anti-clipping / anti “bande” globale --- */
main,
main > section,
main > * > section,
main > section > .container,
main > * > section > .container {
  overflow: visible !important; /* ne coupe pas le halo */
  background: transparent !important; /* pas de bande opaque */
  border: 0 !important;
}

/* ============================================
   HERO — animation d’intensité + voile léger
   (complète ton décor hero__bg::before existant)
   ============================================ */

.hero {
  --hero-sat-min: 1.1;
  --hero-sat-max: 1.5;
  --hero-bright-min: 1;
  --hero-bright-max: 1.5;
  --hero-fade-mid: 0.9;
  --hero-dur: 16s;
}

.hero .hero__bg::before {
  animation: heroHaloGlow var(--hero-dur) ease-in-out infinite;
  will-change: filter, opacity;
}

.hero .hero__bg::after {
  content: "";
  position: absolute;
  inset: 0;
  left: 50%;
  transform: translateX(-50%);
  width: inherit;
  pointer-events: none;
  z-index: 0;
  mix-blend-mode: screen;
  background:
    radial-gradient(
      55% 40% at 50% 22%,
      rgba(255, 255, 255, 0.22),
      transparent 60%
    ),
    radial-gradient(
      80% 60% at 20% 0%,
      rgba(255, 255, 255, 0.1),
      transparent 70%
    ),
    radial-gradient(
      80% 60% at 80% 0%,
      rgba(255, 255, 255, 0.1),
      transparent 70%
    );
  opacity: 0;
  animation: heroHaloVeil var(--hero-dur) ease-in-out infinite;
}

@keyframes heroHaloGlow {
  0% {
    filter: saturate(var(--hero-sat-min)) brightness(var(--hero-bright-min));
    opacity: 0.98;
  }
  50% {
    filter: saturate(var(--hero-sat-max)) brightness(var(--hero-bright-max));
    opacity: var(--hero-fade-mid);
  }
  100% {
    filter: saturate(calc((var(--hero-sat-min) + var(--hero-sat-max)) / 2))
      brightness(var(--hero-bright-min));
    opacity: 0.98;
  }
}
@keyframes heroHaloVeil {
  0%,
  100% {
    opacity: 0;
  }
  50% {
    opacity: 0.18;
  }
}

/* Préfère moins d’anim */
@media (prefers-reduced-motion: reduce) {
  .hero .hero__bg::before,
  .hero .hero__bg::after,
  .section--halo::before {
    animation: none !important;
    filter: none !important;
    opacity: 1 !important;
  }
}

/* ============================================
   Ajustements utiles
   ============================================ */

/* 1re section sous le héro : halo remonte moins pour laisser respirer le titre */
#home > section.section--halo:first-of-type::before {
  --halo-overlap: 60px;
  opacity: 0.75;
}

/* Si une grille interne clippe (ex: projets), garde visible */
#home [aria-labelledby="dern-projets"] .projects-grid {
  overflow: visible;
}
/* ============================================
   Ajuste le halo du HERO en thème clair
   pour éviter l'effet "plus de couleur"
   ============================================ */

:root[data-theme="light"] .hero {
  /* on garde la couleur plus présente, moins de flash blanc */
  --hero-sat-min: 1.15;
  --hero-sat-max: 1.3;
  --hero-bright-min: 1.02;
  --hero-bright-max: 1.18;
  --hero-fade-mid: 0.98; /* ne descend presque pas en opacité */
}

/* voile blanc moins fort en thème clair */
:root[data-theme="light"] .hero .hero__bg::after {
  opacity: 0;
  animation: heroHaloVeilLight var(--hero-dur) ease-in-out infinite;
}

/* variante plus douce du voile */
@keyframes heroHaloVeilLight {
  0%,
  100% {
    opacity: 0;
  }
  50% {
    opacity: 0.1; /* au lieu de 0.18 → moins “blanchi” */
  }
}
