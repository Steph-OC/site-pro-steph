@layer components {
  /* =========================
     HERO — structure & sécurité
     ========================= */
  .hero {
    position: relative;
    border-bottom: 0;
    /* évite les scrollbars dues aux décors latéraux */
    overflow-x: clip;
    /* laisse passer les halos/auroras vers le bas */
    overflow-y: visible;
    padding-block: clamp(44px, 8vw, 120px) clamp(24px, 4vw, 48px);
    isolation: isolate; /* nouveau stacking context */
  }
  .hero__inner {
    max-width: var(--hero-max);
    margin: 0 auto;
    padding-inline: clamp(12px, 2vw, 24px);
    position: relative;
    z-index: 1;
  }
  .hero__bg {
    position: absolute;
    inset: 0;
    z-index: 0;
    pointer-events: none; /* décor seulement */
    overflow: visible;
  }
  .hero > * {
    position: relative;
    z-index: 1;
  }

  /* =========================
     HERO — aurora (grand décor)
     ========================= */
  .hero .hero__bg::before {
    content: "";
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 100vw; /* plus fiable que 100dvw */
    top: -16vh;
    bottom: -45vh;
    z-index: 0;

    /* teintes (clair) */
    --a1: color-mix(in srgb, var(--green) 70%, #7dd3fc 30%);
    --a2: color-mix(in srgb, var(--orange) 75%, #e879f9 25%);
    --a3: color-mix(in srgb, #7c3aed 65%, #22d3ee 35%);

    background: radial-gradient(
        800px 420px at 10% 10%,
        color-mix(in srgb, var(--a2) 52%, transparent) 0%,
        transparent 70%
      ),
      radial-gradient(
        700px 380px at 85% 8%,
        color-mix(in srgb, var(--a1) 48%, transparent) 0%,
        transparent 72%
      ),
      conic-gradient(
        from 200deg at 55% 35%,
        color-mix(in srgb, var(--a3) 22%, transparent) 0 20%,
        transparent 35% 55%,
        color-mix(in srgb, var(--a1) 18%, transparent) 70%,
        transparent 100%
      ),
      radial-gradient(
        160% 90% at 50% -10%,
        color-mix(in srgb, var(--card) 80%, transparent) 0%,
        transparent 60%
      ),
      linear-gradient(
        180deg,
        color-mix(in srgb, var(--bg) 85%, var(--card) 15%) 0%,
        color-mix(in srgb, var(--bg) 100%, var(--card) 0%) 60%
      );

    /* fondu bas propre */
    -webkit-mask-image: linear-gradient(
      #000,
      #000 calc(100% - 16vh),
      transparent
    );
    mask-image: linear-gradient(#000, #000 calc(100% - 16vh), transparent);

    filter: saturate(110%) contrast(102%);
    will-change: transform, opacity;
  }
  :root[data-theme="dark"] .hero .hero__bg::before {
    --a1: color-mix(in srgb, var(--green) 55%, #60a5fa 45%);
    --a2: color-mix(in srgb, var(--orange) 55%, #f472b6 45%);
    --a3: color-mix(in srgb, #8b5cf6 60%, #06b6d4 40%);
    filter: saturate(100%) brightness(95%);
  }

  /* =========================
     HERO — contenu
     ========================= */
  .hero__grid {
    display: grid;
    gap: clamp(16px, 3vw, 32px);
    align-items: center;
  }
  .hero__grid.has-visual {
    grid-template-columns: var(--hero-grid-left) var(--hero-grid-right);
  }
  @media (max-width: 900px) {
    .hero__grid.has-visual {
      grid-template-columns: 1fr;
    }
  }
  .hero__visual {
    min-height: 280px;
    display: grid;
    place-items: center;
  }
  .hero h1 {
    margin: 0 0 0.5rem;
  }
  .hero p {
    margin: 0.2rem 0 1rem;
    color: var(--muted);
    max-width: 70ch;
  }

  /* =========================
     Visuel PC — tilt & reflets
     ========================= */
  .pc {
    width: 100%;
    max-width: var(--pc-max);
    height: auto;
  }
  .pc-tilt {
    position: relative;
    transform-style: preserve-3d;
    perspective: 1000px;
    transform: scale(var(--pc-scale)) rotateY(var(--pc-tilt-y))
      rotateX(var(--pc-tilt-x));
    transform-origin: 50% 50%;
    transition: transform 0.55s cubic-bezier(0.22, 0.61, 0.36, 1),
      filter 0.35s ease;
    filter: drop-shadow(
      0 24px 40px color-mix(in srgb, var(--gray) 22%, transparent 78%)
    );
    will-change: transform, filter;
    overflow: visible;
  }
  .pc [data-role="chassis"],
  .pc [data-role="screen"] {
    stroke: var(--pc-contour);
    stroke-width: 1px;
    vector-effect: non-scaling-stroke;
  }
  .pc-gloss {
    position: absolute;
    inset: 0;
    pointer-events: none;
    border-radius: 20px;
    background: linear-gradient(
      120deg,
      color-mix(in srgb, var(--white) 14%, transparent 86%) 10%,
      transparent 35%,
      transparent 65%,
      color-mix(in srgb, var(--white) 10%, transparent 90%) 90%
    );
    mix-blend-mode: screen;
    opacity: 0.35;
    transform: translateZ(1px);
    mask-image: radial-gradient(100% 100% at 0 0, #000 0, transparent 70%);
  }
  html[data-theme="dark"] .pc-gloss {
    display: none;
  }
  html[data-theme="dark"] .pc-tilt {
    filter: none;
  }

  /* Animations internes du visuel (si présentes) */
  .hero__visual .code-run {
    animation: codeScroll var(--t) linear infinite both;
    will-change: transform;
  }
  .hero__visual .code-fade {
    animation: codeFade var(--t) linear infinite both;
    will-change: opacity;
  }
  .hero__visual #siteLayer {
    animation: siteFade var(--t) linear infinite both;
    will-change: opacity;
  }

  @keyframes codeScroll {
    0% {
      transform: translateY(0);
    }
    70.98% {
      transform: translateY(calc(-1 * var(--chunk)));
    }
    100% {
      transform: translateY(calc(-1 * var(--chunk)));
    }
  }
  @keyframes codeFade {
    0%,
    70.98% {
      opacity: 1;
    }
    73.67%,
    97.34% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
  @keyframes siteFade {
    0%,
    70.98% {
      opacity: 0;
    }
    73.67%,
    97.34% {
      opacity: 1;
    }
    100% {
      opacity: 0;
    }
  }

  @media (hover: hover) {
    .hero__visual .pc-tilt {
      cursor: pointer;
    }
    .hero__visual .pc-tilt:hover {
      transform: scale(calc(var(--pc-scale) * 1.02))
        rotateY(calc(var(--pc-tilt-y) + 6deg))
        rotateX(calc(var(--pc-tilt-x) + 2deg)) translateY(-2px);
      filter: drop-shadow(
        0 28px 46px color-mix(in srgb, var(--gray) 28%, transparent 72%)
      );
    }
  }
  @media (prefers-reduced-motion: reduce) {
    .hero__visual .code-run,
    .hero__visual .code-fade,
    .hero__visual #siteLayer {
      animation: none !important;
    }
    .hero__visual .pc-tilt {
      transition: none !important;
    }
    .hero__visual .pc-gloss {
      animation: none !important;
      opacity: 0 !important;
    }
  }

  /* Reflet balayage au survol */
  .pc-tilt::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    border-radius: 20px;
    transform: translateX(-20%) skewX(-14deg);
    opacity: 0;
    mix-blend-mode: screen;
    background: linear-gradient(
      100deg,
      transparent 0%,
      color-mix(in srgb, var(--white) 30%, transparent) 48%,
      transparent 62%
    );
  }
  :root:not([data-theme="dark"]) .pc-tilt::after {
    background: linear-gradient(
      100deg,
      transparent 0%,
      color-mix(in srgb, var(--pc-shine-color) 100%, transparent) 48%,
      transparent 62%
    );
  }
  :root:not([data-theme="dark"]) .hero__visual:hover .pc-tilt::after {
    opacity: 0.52;
  }
  html[data-theme="dark"] .pc-tilt::after {
    background: linear-gradient(
      100deg,
      transparent 0%,
      color-mix(in srgb, var(--white) 22%, transparent) 48%,
      transparent 62%
    );
  }
  .hero__visual:hover .pc-tilt::after {
    animation: pcShineSlow 1400ms cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
  }
  @keyframes pcShineSlow {
    0% {
      transform: translateX(-20%) skewX(-14deg);
      opacity: 0;
    }
    10% {
      opacity: 0.45;
    }
    70% {
      opacity: 0.4;
    }
    100% {
      transform: translateX(120%) skewX(-14deg);
      opacity: 0;
    }
  }

  /* =========================
     SECTIONS — halos animés
     (variantes par section via nth-of-type)
     ========================= */
  .section--halo {
    position: relative;
    isolation: isolate; /* halos derrière le contenu de la section */
    overflow: visible;
    z-index: 0;
  }
  .section--halo > * {
    position: relative;
    z-index: 1;
  }

  /* halo de section (fond animé) */
  .section--halo::before {
    content: "";
    position: absolute;
    z-index: 0;
    pointer-events: none;

    /* variables par défaut (surclassées plus bas) */
    --halo-w: min(1100px, 92vw);
    --halo-h: 420px;
    --halo-x: 0px;
    --halo-y: 0px;
    --halo-overlap: 140px; /* chevauchement vers le haut */
    --halo-rotate: 0deg;
    --halo-scale: 1;
    --halo-delay: 0s;
    --halo-duration: 6.5s;

    width: var(--halo-w);
    height: var(--halo-h);
    left: 50%;
    bottom: calc(100% - var(--halo-overlap));
    transform-origin: 50% 100%;
    transform: translate(calc(-50% + var(--halo-x)), var(--halo-y))
      rotate(var(--halo-rotate)) scale(var(--halo-scale));

    --halo-a: color-mix(in srgb, var(--green) 20%, transparent);
    --halo-b: color-mix(in srgb, var(--orange) 18%, transparent);

    background: radial-gradient(
        60% 55% at 30% 40%,
        var(--halo-a),
        transparent 65%
      ),
      radial-gradient(60% 55% at 70% 60%, var(--halo-b), transparent 70%);
    filter: blur(38px) saturate(120%);
    opacity: 0.9;

    animation: haloBreath var(--halo-duration) ease-in-out var(--halo-delay)
        infinite,
      haloDrift 18s ease-in-out calc(var(--halo-delay) * 0.5) infinite alternate;
  }

  @keyframes haloBreath {
    0%,
    100% {
      opacity: 0.78;
      transform: translate(calc(-50% + var(--halo-x)), var(--halo-y))
        rotate(var(--halo-rotate)) scale(calc(var(--halo-scale) * 1));
    }
    50% {
      opacity: 1;
      transform: translate(calc(-50% + var(--halo-x)), var(--halo-y))
        rotate(var(--halo-rotate)) scale(calc(var(--halo-scale) * 1.06));
    }
  }
  @keyframes haloDrift {
    0% {
      filter: blur(36px) saturate(118%);
    }
    50% {
      filter: blur(44px) saturate(124%);
    }
    100% {
      filter: blur(38px) saturate(120%);
    }
  }
  @media (prefers-reduced-motion: reduce) {
    .section--halo::before {
      animation: none !important;
      opacity: 0.85;
    }
  }
  :root[data-theme="dark"] .section--halo::before {
    --halo-a: color-mix(in srgb, #60a5fa 22%, transparent);
    --halo-b: color-mix(in srgb, #8b5cf6 20%, transparent);
    filter: blur(44px) saturate(118%) brightness(0.96);
    opacity: 0.88;
  }

  /* Variations par section (ordre réel de la home) */
  main#home > section.section--halo:nth-of-type(1)::before {
    --halo-h: 360px;
    --halo-overlap: 120px;
    --halo-x: -40px;
    --halo-rotate: -4deg;
    --halo-delay: 0.2s;
    --halo-duration: 6s;
  }
  main#home > section.section--halo:nth-of-type(2)::before {
    --halo-w: min(1250px, 95vw);
    --halo-h: 440px;
    --halo-overlap: 160px;
    --halo-x: 0px;
    --halo-rotate: 2deg;
    --halo-delay: 0.6s;
    --halo-duration: 7s;
  }
  main#home > section.section--halo:nth-of-type(3)::before {
    --halo-h: 420px;
    --halo-overlap: 110px;
    --halo-x: 60px;
    --halo-y: 6px;
    --halo-rotate: 5deg;
    --halo-delay: 0.1s;
    --halo-duration: 6.8s;
  }
  main#home > section.section--halo:nth-of-type(4)::before {
    --halo-w: min(1000px, 88vw);
    --halo-h: 360px;
    --halo-overlap: 130px;
    --halo-x: -20px;
    --halo-rotate: -6deg;
    --halo-delay: 0.8s;
    --halo-duration: 6.2s;
  }
  main#home > section.section--halo:nth-of-type(5)::before {
    --halo-w: min(1280px, 96vw);
    --halo-h: 480px;
    --halo-overlap: 180px;
    --halo-x: 20px;
    --halo-y: 10px;
    --halo-rotate: 3deg;
    --halo-delay: 0.3s;
    --halo-duration: 7.2s;
  }
  main#home > section.section--halo:nth-of-type(6)::before {
    --halo-h: 320px;
    --halo-overlap: 100px;
    --halo-x: 0px;
    --halo-rotate: 0deg;
    --halo-delay: 0.5s;
    --halo-duration: 6.4s;
  }
  main#home > section.section--halo:nth-of-type(7)::before {
    --halo-w: min(900px, 86vw);
    --halo-h: 300px;
    --halo-overlap: 120px;
    --halo-x: -30px;
    --halo-rotate: -2deg;
    --halo-delay: 0.15s;
    --halo-duration: 5.8s;
  }
  main#home > section.section--halo:nth-of-type(8)::before {
    --halo-w: min(1350px, 98vw);
    --halo-h: 520px;
    --halo-overlap: 200px;
    --halo-x: 10px;
    --halo-rotate: 6deg;
    --halo-delay: 0.9s;
    --halo-duration: 7.6s;
  }

  /* Helpers optionnels */
  .section--halo.halo-left::before {
    --halo-x: -60px;
    --halo-rotate: -5deg;
  }
  .section--halo.halo-right::before {
    --halo-x: 60px;
    --halo-rotate: 5deg;
  }
  .section--halo.halo-tall::before {
    --halo-h: 500px;
    --halo-overlap: 180px;
  }
}
